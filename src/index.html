<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Tabbed Interface</title>
    <style>
        /* Global Styles & Variables */
        :root {
            --primary-color: #2e4d3b;
            --secondary-color: #3a604a;
            --accent-color: #b3dfc7;
            --text-color: #cdddd4;
            --bg-color: #f4f6f9;
            --gray: #6d8577;
            --gray-contrast: #414d46;
            --header-height: 60px;
            --sidebar-width: 240px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: #333;
            overflow-x: hidden;
        }

        span {
            color: var(--text-color);
            text-align: center;
        }

        /* Main Layout Structure */
        .page-container {
            display: grid;
            grid-template-columns: var(--sidebar-width) 1fr;
            grid-template-rows: var(--header-height) 1fr;
            height: 100vh;
        }

        /* Header */
        .main-header {
            grid-column: 1 / -1;
            grid-row: 1 / 2;
            display: flex;
            align-items: center;
            padding: 0 20px;
            background-color: var(--primary-color);
            color: var(--text-color);
            z-index: 1000;
        }

        .floater {
            width: 60px;
            height: 60px;
            background-color: var(--secondary-color);
            position: absolute;
            top: 70px;
            right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hidden {
            visibility: hidden;
        }

        .grid {
            display: grid !important;
        }

        .loader {
            border: 4px solid var(--bg-color);
            border-top: 4px solid var(--gray);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .main-header> :first-child {
            margin-right: auto;
        }

        .main-header .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* Hamburger Menu */
        .hamburger-menu {
            display: none;
            cursor: pointer;
            width: 30px;
            height: 22px;
            position: relative;
            z-index: 1002;
            margin-left: 12px;
        }

        .hamburger-menu .bar {
            display: block;
            width: 100%;
            height: 3px;
            background-color: var(--text-color);
            position: absolute;
            left: 0;
            transition: all var(--transition-speed) ease-in-out;
        }

        .hamburger-menu .bar1 {
            top: 0;
        }

        .hamburger-menu .bar2 {
            top: 50%;
            transform: translateY(-50%);
        }

        .hamburger-menu .bar3 {
            bottom: 0;
        }

        .sidebar-open .hamburger-menu .bar1 {
            top: 50%;
            transform: translateY(-50%) rotate(45deg);
        }

        .sidebar-open .hamburger-menu .bar2 {
            opacity: 0;
        }

        .sidebar-open .hamburger-menu .bar3 {
            bottom: 50%;
            transform: translateY(50%) rotate(-45deg);
        }

        /* Sidebar / Navigation Tabs */
        .sidebar {
            grid-column: 1 / 2;
            grid-row: 2 / 3;
            background-color: var(--secondary-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-speed) ease-in-out;
        }

        .tab-button {
            width: 100%;
            padding: 15px 20px;
            background-color: transparent;
            border: none;
            color: var(--text-color);
            font-size: 1rem;
            text-align: left;
            cursor: pointer;
            transition: background-color var(--transition-speed), color var(--transition-speed);
            border-left: 4px solid transparent;
        }

        .tab-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .tab-button.active {
            background: linear-gradient(to right, rgba(0, 0, 0, 0) 0%, var(--primary-color) 100%);
            color: var(--accent-color);
            border-left-color: var(--accent-color);
            font-weight: bold;
        }

        /* Content Area */
        .content-area {
            grid-column: 2 / 3;
            grid-row: 2 / 3;
            padding: 30px;
            overflow-y: auto;
        }

        .content-panel {
            display: none;
        }

        .content-panel.active {
            display: block;
        }

        .content-panel h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .content-panel p {
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .error-icon {
            color: yellow;
            display: none;
            animation: flashYellowAndRed 2s infinite;
            font-size: xx-large;
            border: 2px solid var(--accent-color);
            padding-inline: 12px;
        }

        .error-icon.visible {
            display: block;
        }

        @keyframes flashYellowAndRed {

            0%,
            100% {
                color: yellow;
            }

            50% {
                color: red;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .error-icon {
                animation: none;
                color: red;
            }
        }

        /* Mobile Overlay */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .sidebar-open .mobile-overlay {
            display: block;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .page-container {
                grid-template-columns: 1fr;
            }

            .main-header .logo {
                font-size: 1.2rem;
            }

            .hamburger-menu {
                display: block;
            }

            .sidebar {
                grid-column: 1 / -1;
                position: fixed;
                top: var(--header-height);
                left: 0;
                width: var(--sidebar-width);
                height: calc(100vh - var(--header-height));
                z-index: 2;
                transform: translateX(-100%);
                padding-top: 0;
                flex-direction: row;
                flex-wrap: wrap;
                align-content: flex-start;
                background-color: var(--secondary-color);
            }

            .sidebar-open .sidebar {
                transform: translateX(0);
            }

            .tab-button {
                text-align: center;
                border-left: none;
                border-bottom: 2px solid transparent;
                padding: 20px 10px;
            }

            .tab-button.active {
                border-bottom-color: var(--accent-color);
            }

            .content-area {
                grid-column: 1 / -1;
                padding-top: 30px;
            }
        }

        @media (max-width: 480px) {
            .tab-button {
                width: 100%;
            }
        }

        /* Settings Widgets */
        button {
            padding: 5px;
            background-color: transparent;
            border: none;
            transition: all 0.05s ease-in-out;
        }

        button:hover {
            background-color: rgba(242, 199, 199, 0.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: translateY(2px);
            scale: 0.95;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            grid-column-gap: 20px;
        }

        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: repeat(1, 1fr);
            }
        }

        .settings-widget {
            border-radius: 12px;
            padding: 20px;
            margin: 10px;
            background-color: var(--accent-color);
            display: grid;
            grid-auto-rows: min-content;
        }

        .settings-widget>span:first-child {
            color: var(--primary-color);
            font-size: 14pt;
        }

        .settings-widget>span:nth-child(2) {
            color: var(--gray);
            font-size: 10pt;
            margin-bottom: 8px;
        }

        .input {
            display: flex;
            width: fit-content;
            color: var(--text-color);
            align-items: center;
        }

        .input label {
            width: min-content;
            margin-right: 12px;
            min-width: 50px;
            text-align: right;
        }

        input:focus-within,
        select:focus-within {
            outline: 2px solid var(--gray);
        }

        input,
        select {
            padding: 8px;
            border-right: 2px solid var(--gray);
            color: var(--gray);
            border-radius: 8px;
            margin-right: 5px;
            min-width: 60px;
            outline: none;
            background: var(--bg-color);
            font-size: 11pt;
            border: none;
            width: 100%;
        }

        .sensor {
            background: var(--gray);
            color: var(--text-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
        }

        .sensor>div:not(:first-child) {
            margin-right: 8px;
        }

        .sensor>div:first-child {
            border-right: solid 2px var(--accent-color);
            width: min-content;
            padding: 10px;
            margin-right: 12px;
            color: var(--accent-color);
        }

        .sensor span {
            color: var(--text-color);
            font-weight: bold;
        }

        .sensor button:first-of-type {
            margin-left: auto;
        }

        .sensor button {
            margin-right: 8px;
        }

        .sensor-settings {
            margin-top: 12px;
            margin-bottom: 12px;
            /* display: none; */
            display: grid;
            background: var(--gray-contrast);
            padding: 14px;
            border-radius: 8px;
            gap: 18px;
        }

        .sensor-settings * {
            width: 100%;

        }

        .relay-settings {
            display: grid;
            grid-template-columns: 1fr auto 1fr auto auto;
        }

        .operator {
            background: var(--gray-contrast);
            font-size: large;
            border: 2px solid var(--gray);
            color: var(--text-color);
            text-align: center;
        }

        .relay-settings .input {
            padding: 0 4px;
        }

        .arrow-container {
            display: flex;
            flex-direction: column;
        }

        .arrow-container button {
            padding: 2px;
        }

        .add-selector {
            margin-top: 12px;
            border: 2px solid var(--gray);
        }
    </style>
</head>

<body>
    <div class="floater hidden">
        <div class="loader"></div>
    </div>
    <div class="page-container">
        <!-- Header -->
        <header class="main-header">
            <div class="logo">PhytoLabs</div>
            <div class="error-icon" title="Error: Something went wrong" aria-label="Error indicator">!</div>
            <div class="hamburger-menu" aria-label="Toggle navigation" aria-expanded="false">
                <span class="bar bar1"></span>
                <span class="bar bar2"></span>
                <span class="bar bar3"></span>
            </div>
        </header>

        <!-- Mobile Overlay -->
        <div class="mobile-overlay"></div>

        <!-- Sidebar with Tabs -->
        <nav class="sidebar" role="tablist">
            <button id="tab-dashboard" class="tab-button active" data-tab="dashboard" role="tab"
                aria-selected="true">Dashboard</button>
            <button id="tab-profile" class="tab-button" data-tab="profile" role="tab"
                aria-selected="false">Settings</button>
        </nav>

        <!-- Main Content Area -->
        <main class="content-area">
            <section id="dashboard" class="content-panel" role="tabpanel" aria-labelledby="tab-dashboard">
                <h2>Dashboard</h2>
                <p id="DataUpdates">Welcome to your dashboard. Here you can see an overview of your account activity and
                    recent notifications.</p>
            </section>

            <section id="profile" class="content-panel active" role="tabpanel" aria-labelledby="tab-profile">
                <h2>Settings</h2>
                <section class="settings-grid">
                    <div class="settings-widget">
                        <span>Sensors</span>
                        <span>Add/Remove/Configure sensors (inputs)</span>
                        <div id="sensor-container">No sensors added (or loaded yet)</div>
                        <select class="add-selector" onchange="addSensor(this.value, this)">
                            <option value="0">Add Sensor</option>
                            <option value="Soil">Soil Moisture</option>
                        </select>
                    </div>
                    <div class="settings-widget">
                        <span>Relays</span>
                        <span>Add/Remove/Configure relays (outputs)</span>
                        <div id="relay-container">No relays added (or loaded yet)
                            <!-- Start of relay -->

                            <!-- End of relay -->
                        </div>
                        <select class="add-selector" onchange="addRelay(this.value, this)">
                            <option value="0">Add Relay</option>
                            <option value="Relay">Standard Relay</option>
                        </select>
                    </div>
                </section>
            </section>
        </main>
    </div>

    <script>
// Data fetching - Initialize and set up polling
getData();
setInterval(getData, 2000);

// ===== CLASS DEFINITIONS =====
class Sensor {
    constructor(id, name, pin, value, folded = true) {
        this.id = id;
        this.name = name;
        this.pin = pin;
        this.value = value;
        this.folded = folded;
    }

    setValue(value) {
        this.value = value;
    }
}

class Condition {
    constructor(sensor, operator, value, id, type) {
        this.sensor = sensor;
        this.operator = operator;
        this.value = value;
        this.id = id;
        this.type = type;
    }
}

class Relay {
    constructor(id, name, pin, conditions = [], status = false, folded = false) {
        this.id = id;
        this.name = name;
        this.pin = pin;
        this.conditions = conditions;
        this.status = status;
        this.folded = folded;
    }

    toggleStatus() {
        this.status = !this.status;
    }

    isOn() {
        return this.status;
    }

    moveCondition(conditionId, direction) {
        const currentIndex = this.conditions.findIndex(c => c.id === conditionId);
        if (currentIndex === -1) return;

        const canMoveUp = direction === 'up' && currentIndex > 0;
        const canMoveDown = direction === 'down' && currentIndex < this.conditions.length - 1;

        if (canMoveUp) {
            this._swapConditions(currentIndex, currentIndex - 1);
        } else if (canMoveDown) {
            this._swapConditions(currentIndex, currentIndex + 1);
        }

        if (canMoveUp || canMoveDown) {
            reloadConditions(this.id);
        }
    }

    _swapConditions(index1, index2) {
        [this.conditions[index1], this.conditions[index2]] =
        [this.conditions[index2], this.conditions[index1]];
    }
}

// ===== DATA STORAGE =====
const sensorList = [];
const relayList = [];

// ===== UTILITY FUNCTIONS =====
function getRelay(id) {
    return relayList.find(r => r.id === id);
}

function getSensor(id) {
    return sensorList.find(s => s.id === id);
}

function resetDropdown(dropdown) {
    dropdown.value = 0;
}

// ===== ADD FUNCTIONS =====
function addSensor(sensortype, dropdown) {
    resetDropdown(dropdown);

    const sensor = new Sensor(
        sensorList.length + 1,
        "Sensor Name",
        1,
        0
    );

    sensorList.push(sensor);
    renderSensors();
}

function addRelay(relaytype, dropdown) {
    resetDropdown(dropdown);

    const relay = new Relay(
        relayList.length + 1,
        "Relay Name",
        1
    );

    relayList.push(relay);
    renderRelays();
}

function addCondition(conditionReceiver, dropdown) {
    const relay = getRelay(conditionReceiver);
    if (!relay) return;

    const condition = new Condition(
        1,
        ">",
        1,
        relay.conditions.length + 1,
        dropdown.value
    );

    // Set sensorId for compatibility with the HTML generation
    condition.sensorId = 1;

    relay.conditions.push(condition);
    renderConditions(relay.id);
    resetDropdown(dropdown);
}

// ===== UPDATE FUNCTIONS =====
function updateRelayName(id, newName) {
    const relay = getRelay(id);
    if (relay) {
        relay.name = newName;

        // Update the display without re-rendering
        const nameDisplay = document.querySelector(`[data-relay-name="${id}"]`);
        const initialDisplay = document.querySelector(`[data-relay-initial="${id}"]`);

        if (nameDisplay) nameDisplay.textContent = newName;
        if (initialDisplay) initialDisplay.textContent = newName.charAt(0);

        // Update condition dropdowns that reference this relay's sensors
        updateConditionDropdowns();

        console.log(`Relay ${id} name updated to ${newName}`);
    }
}

function updateRelayPin(id, pinInput) {
    const relay = getRelay(id);
    if (relay) {
        relay.pin = parseInt(pinInput.value) || 1;
        console.log(`Relay ${id} pin updated to ${relay.pin}`);
    }
}

function updateSensorName(id, newName) {
    const sensor = getSensor(id);
    if (sensor) {
        sensor.name = newName;

        // Update the display without re-rendering
        const nameElement = document.querySelector(`[data-sensor-name="${id}"]`);
        const initialDisplay = document.querySelector(`[data-sensor-initial="${id}"]`);

        if (nameElement) nameElement.textContent = newName;
        if (initialDisplay) initialDisplay.textContent = newName.charAt(0);

        // Update all condition dropdowns that reference sensors
        updateConditionDropdowns();

        console.log(`Sensor ${id} name updated to ${newName}`);
    }
}

function updateSensorPin(id, pin) {
    const sensor = getSensor(id);
    if (sensor) {
        sensor.pin = parseInt(pin) || 1;
        console.log(`Sensor ${id} pin updated to ${sensor.pin}`);
    }
}

// ===== CONDITION UPDATE FUNCTIONS =====
function updateConditionSensor(relayId, conditionId, sensorId) {
    const relay = getRelay(relayId);
    if (!relay) return;

    const condition = relay.conditions.find(c => c.id === conditionId);
    if (condition) {
        condition.sensor = parseInt(sensorId);
        condition.sensorId = parseInt(sensorId); // Keep both for compatibility
        console.log(`Condition ${conditionId} sensor updated to ${sensorId}`);
    }
}

function updateConditionOperator(relayId, conditionId, operator) {
    const relay = getRelay(relayId);
    if (!relay) return;

    const condition = relay.conditions.find(c => c.id === conditionId);
    if (condition) {
        condition.operator = operator;
        console.log(`Condition ${conditionId} operator updated to ${operator}`);
    }
}

function updateConditionValue(relayId, conditionId, value) {
    const relay = getRelay(relayId);
    if (!relay) return;

    const condition = relay.conditions.find(c => c.id === conditionId);
    if (condition) {
        condition.value = parseFloat(value) || 0;
        console.log(`Condition ${conditionId} value updated to ${condition.value}`);
    }
}

function updateConditionDropdowns() {
    // Update all sensor dropdowns in conditions to reflect current sensor names
    const sensorSelects = document.querySelectorAll('.sensor-select');
    sensorSelects.forEach(select => {
        const currentValue = select.value;
        select.innerHTML = sensorList
            .map(sensor => `
                <option value="${sensor.id}" ${sensor.id == currentValue ? 'selected' : ''}>
                    ${sensor.name}
                </option>
            `)
            .join('');
    });
}

function removeCondition(relayId, conditionId) {
    const relay = getRelay(relayId);
    if (!relay) return;

    const index = relay.conditions.findIndex(c => c.id === conditionId);
    if (index !== -1) {
        relay.conditions.splice(index, 1);
        renderConditions(relayId);
        console.log(`Condition ${conditionId} removed from relay ${relayId}`);
    }
}

// ===== RENDER FUNCTIONS =====
function renderSensors() {
    const container = document.getElementById('sensor-container');
    if (!container) return;

    container.innerHTML = sensorList.map(createSensorHTML).join('');
}

function renderRelays() {
    const container = document.getElementById('relay-container');
    if (!container) return;

    container.innerHTML = relayList.map(createRelayHTML).join('');
}

function renderConditions(relayId) {
    const relay = getRelay(relayId);
    if (!relay) return;

    const container = document.querySelector(`[data-relay-id="${relayId}"]`);
    if (!container) return;

    container.innerHTML = relay.conditions
        .map(condition => createConditionHTML(condition, relayId))
        .join('');
}

function reloadConditions(relayId) {
    renderConditions(relayId); // Same functionality, cleaner implementation
}

// ===== SETTINGS TOGGLE FUNCTIONS =====
function toggleSensorSettings(sensorId) {
    const sensor = getSensor(sensorId);
    const settingsPanel = document.querySelector(`[data-sensor-container="${sensorId}"]`);

    if (sensor && settingsPanel) {
        sensor.folded = !sensor.folded;

        if (sensor.folded) {
            settingsPanel.classList.remove('grid');
        } else {
            settingsPanel.classList.add('grid');
        }
    }
}

function toggleRelaySettings(relayId) {
    const relay = getRelay(relayId);
    const settingsPanel = document.querySelector(`[data-relay-container="${relayId}"]`);

    if (relay && settingsPanel) {
        relay.folded = !relay.folded;

        if (relay.folded) {
            settingsPanel.classList.remove('grid');
        } else {
            settingsPanel.classList.add('grid');
        }
    }
}

// ===== HTML GENERATION FUNCTIONS =====
function createSensorHTML(sensor) {
    return `
        <div id="${sensor.id}">
            <div class="sensor">
                <div data-sensor-initial="${sensor.id}">${sensor.name.charAt(0)}</div>
                <div>
                    <span data-sensor-name="${sensor.id}">${sensor.name}</span>:
                    <span data-sensor-value="${sensor.id}">${sensor.value}</span>
                </div>
                <button onclick="toggleSensorSettings(${sensor.id})" aria-label="Toggle sensor">‚öôÔ∏è</button>
                <button aria-label="Remove sensor">‚ùå</button>
            </div>
            <div class="sensor-settings ${sensor.folded ? '' : 'grid'}" data-sensor-container="${sensor.id}">
                <div class="input">
                    <label for="sensor-name">Name: </label>
                    <input
                        type="text"
                        id="sensor-name"
                        placeholder="Jeff maybe?"
                        value="${sensor.name}"
                        onchange="updateSensorName(${sensor.id}, this.value)"
                    >
                </div>
                <div class="input">
                    <label for="sensor-pin">Pin: </label>
                    <input
                        type="number"
                        id="sensor-pin"
                        placeholder="Devboard pin number"
                        value="${sensor.pin}"
                        onchange="updateSensorPin(${sensor.id}, this.value)"
                    >
                </div>
            </div>
        </div>
    `;
}

function createRelayHTML(relay) {
    return `
        <div id="${relay.id}">
            <div class="sensor">
                <div data-relay-initial="${relay.id}">${relay.name.charAt(0)}</div>
                <div>
                    <span data-relay-name="${relay.id}">${relay.name}</span>:
                    <span data-relay-status="${relay.id}">${relay.status ? 'üü¢' : 'üü•'}</span>
                </div>
                <button onclick="toggleRelaySettings(${relay.id})">‚öôÔ∏è</button>
                <button onclick="removeRelay(${relay.name})">‚ùå</button>
            </div>
            <div class="sensor-settings ${relay.folded ? '' : 'grid'}" data-relay-container="${relay.id}">
                <div class="input">
                    <label for="relay-name">Name:</label>
                    <input
                        type="text"
                        name="relay-name"
                        id="relay-name"
                        placeholder="*ahem* jeff?"
                        value="${relay.name}"
                        onchange="updateRelayName(${relay.id}, this.value)"
                    >
                </div>
                <div class="input">
                    <label for="relay-pin">Pin: </label>
                    <input
                        type="number"
                        id="relay-pin"
                        placeholder="Devboard output pin"
                        value="${relay.pin}"
                        onchange="updateRelayPin(${relay.id}, this)"
                    >
                </div>
                <span>Conditions</span>
                <div data-relay-id="${relay.id}"></div>
                <select onchange="addCondition(${relay.id}, this)">
                    <option value="0">Add Condition</option>
                    <option value="sensor">Sensor Condition</option>
                </select>
            </div>
        </div>
    `;
}

function createConditionHTML(condition, relayId) {
    if (condition.type !== 'sensor') return '';

    const sensorOptions = sensorList
        .map(sensor => `
            <option value="${sensor.id}" ${sensor.id === condition.sensorId ? 'selected' : ''}>
                ${sensor.name}
            </option>
        `)
        .join('');

    return `
        <div class="relay-settings" data-condition-id="${condition.id}">
            <div class="input">
                <select
                    class="sensor-select"
                    data-condition-sensors="${relayId}"
                    onchange="updateConditionSensor(${relayId}, ${condition.id}, this.value)"
                >
                    ${sensorOptions}
                </select>
            </div>
            <div class="input">
                <select
                    class="operator-select operator"
                    onchange="updateConditionOperator(${relayId}, ${condition.id}, this.value)"
                >
                    <option value=">" ${condition.operator === '>' ? 'selected' : ''}>&gt;</option>
                    <option value="<" ${condition.operator === '<' ? 'selected' : ''}>&lt;</option>
                </select>
            </div>
            <div class="input">
                <input
                    type="number"
                    class="condition-value"
                    value="${condition.value}"
                    placeholder="Value"
                    onchange="updateConditionValue(${relayId}, ${condition.id}, this.value)"
                >
            </div>
            <div class="arrow-container">
                <button
                    class="move-up"
                    onclick="getRelay(${relayId}).moveCondition(${condition.id}, 'up')"
                >‚¨ÜÔ∏è</button>
                <button
                    class="move-down"
                    onclick="getRelay(${relayId}).moveCondition(${condition.id}, 'down')"
                >‚¨áÔ∏è</button>
            </div>
            <button
                class="remove-condition"
                onclick="removeCondition(${relayId}, ${condition.id})"
            >‚ùå</button>
        </div>
    `;
}

// ===== DATA FETCHING =====
function getData() {
    fetch('readADC')
        .then(response => response.text())
        .then(data => {
            const element = document.getElementById("DataUpdates");
            if (element) {
                element.innerHTML = data;
            }
        })
        .catch(error => console.error('Error:', error));
}

// ===== UI EVENT HANDLERS =====
document.addEventListener('DOMContentLoaded', function() {
    const body = document.body;
    const hamburgerMenu = document.querySelector('.hamburger-menu');
    const mobileOverlay = document.querySelector('.mobile-overlay');
    const sidebar = document.querySelector('.sidebar');
    const tabButtons = document.querySelectorAll('.tab-button');
    const contentPanels = document.querySelectorAll('.content-panel');

    if (!hamburgerMenu || !mobileOverlay || !sidebar) return;

    const toggleMobileMenu = () => {
        const isOpen = body.classList.toggle('sidebar-open');
        hamburgerMenu.setAttribute('aria-expanded', isOpen);
    };

    const handleTabClick = (e) => {
        if (!e.target.classList.contains('tab-button')) return;

        const tabButton = e.target;
        const targetTabId = tabButton.dataset.tab;

        // Reset all tabs
        tabButtons.forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-selected', 'false');
        });
        contentPanels.forEach(panel => panel.classList.remove('active'));

        // Activate selected tab
        tabButton.classList.add('active');
        tabButton.setAttribute('aria-selected', 'true');

        const targetPanel = document.getElementById(targetTabId);
        if (targetPanel) {
            targetPanel.classList.add('active');
        }

        // Close mobile menu if open
        if (window.innerWidth <= 768 && body.classList.contains('sidebar-open')) {
            toggleMobileMenu();
        }
    };

    const handleEscapeKey = (e) => {
        if (e.key === 'Escape' && body.classList.contains('sidebar-open')) {
            toggleMobileMenu();
        }
    };

    // Event listeners
    hamburgerMenu.addEventListener('click', toggleMobileMenu);
    mobileOverlay.addEventListener('click', toggleMobileMenu);
    sidebar.addEventListener('click', handleTabClick);
    document.addEventListener('keydown', handleEscapeKey);
});
    </script>
</body>

</html>